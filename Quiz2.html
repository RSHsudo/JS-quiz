<!DOCTYPE html>
<html lang="en-US">

<head>
    <meta charset="utf-8">
    <title>Doggo Fetch</title>
    <style>
        body {
            margin: 1rem auto;
            padding: 3rem;
            font-family: sans-serif;
        }

        header {
            width: 70%;
            margin: 1em auto;
        }

        main {
            max-width: 70%;
            margin: 0px auto;
            display: flex;
            flex-direction: column;
        }

        img {
            max-width: 100%;
        }

        #image-frame {
            font-size: x-large;
            text-align: center;
            margin: 1rem auto;
        }

        #explanation,
        #score {
            padding: 1rem;
            text-align: center;
        }

        #options {
            max-width: 100%;
            display: flex;
            flex-direction: column;
        }

        button {
            padding: 0.5rem;
            font-size: medium;
            border-radius: 5px;
        }

        .correct {
            background-color: lightgreen;
        }

        .incorrect {
            background-color: lightpink;
        }

        .hidden {
            display: none;
        }
    </style>
</head>

<body>
    <header>
        <h1>Guess the Doggo</h1>
        <p>What breed is the dog in this image?</p>

    </header>

    <main>
        <div id="image-frame">
        </div>
        <div id="options">
        </div>

    </main>

</body>


<script type="module">

    const RANDOM_IMG_ENDPOINT = "https://dog.ceo/api/breeds/image/random";

    const BREEDS = ["affenpinscher", "african", /* ... (your breed list) ... */ "weimaraner", "whippet", "irish wolfhound"];


    // Utility function to get a randomly selected item from an array
    function getRandomElement(array) {
        const i = Math.floor(Math.random() * array.length);
        return array[i];
    }

    // Utility function to shuffle the order of items in an array in-place
    function shuffleArray(array) {
        return array.sort((a, b) => Math.random() - 0.5);
    }

    // TODO 1
    // Given an array of possible answers, a correct answer value, and a number of choices to get,
    // return a list of that many choices, including the correct answer and others from the array
    function getMultipleChoices(n, correctAnswer, array) {
        const choices = [correctAnswer];
        while (choices.length < n) {
            const randomChoice = getRandomElement(array);
            if (!choices.includes(randomChoice)) {
                choices.push(randomChoice);
            }
        }
        return shuffleArray(choices);
    }

    // TODO 2
    // Given a URL such as "https://images.dog.ceo/breeds/poodle-standard/n02113799_2280.jpg"
    // return the breed name string as formatted in the breed list, e.g. "standard poodle"
    function getBreedFromURL(url) {
        const parts = url.split('/');
        const breedName = parts[parts.length - 2].replace('-', ' ');
        return breedName;
    }

    // TODO 3
    // Given a URL, fetch the resource at that URL, 
    // then parse the response as a JSON object,
    // finally return the "message" property of its body
    async function fetchMessage(url) {
        try {
            const response = await fetch(url);
            const data = await response.json();
            return data.message;
        } catch (error) {
            console.error("Error fetching data:", error);
            return null;
        }
    }

    // Function to add the multiple-choice buttons to the page
    function renderButtons(choicesArray, correctAnswer) {

        // Event handler function to compare the clicked button's value to correctAnswer
        // and add "correct"/"incorrect" classes to the buttons as appropriate
        function buttonHandler(e) {
            if (e.target.value === correctAnswer) {
                e.target.classList.add("correct");
            } else {
                e.target.classList.add("incorrect");
                document.querySelector(`button[value="${correctAnswer}"]`).classList.add("correct");
            }
        }

        const options = document.getElementById("options"); // Container for the multiple-choice buttons

        // Clear existing options
        options.innerHTML = '';

        // for each textContent properties are the value of that choice,
        // attach a "click" event listener with the buttonHandler function,
        // and append the button as a child of the options element
        for (let choice of choicesArray) {
            const button = document.createElement("button");
            button.textContent = choice;
            button.addEventListener("click", buttonHandler);
            options.appendChild(button);
        }
    }

    // Function to add the quiz content to the page
    function renderQuiz(imgUrl, correctAnswer, choices) {
        const image = document.createElement("img");
        image.setAttribute("src", imgUrl);
        const frame = document.getElementById("image-frame");

        image.addEventListener("load", () => {
            // Wait until the image has finished loading before trying to add elements to the page
            frame.replaceChildren(image);
            renderButtons(choices, correctAnswer);
        })

    }

    // Function to load the data needed to display the quiz
    async function loadQuizData() {
        document.getElementById("image-frame").textContent = "Fetching doggo...";

        const doggoImgUrl = await fetchMessage(RANDOM_IMG_ENDPOINT);
        const correctBreed = getBreedFromURL(doggoImgUrl);
        const breedChoices = getMultipleChoices(3, correctBreed, BREEDS);

        return [doggoImgUrl, correctBreed, breedChoices];
    }

    // TODO 5
    // Asynchronously call the loadQuizData() function,
    // Then call renderQuiz() with the returned imageUrl, correctAnswer, and choices 
    (async () => {
        const [imgUrl, breed, choices] = await loadQuizData();
        renderQuiz(imgUrl, breed, choices);
    })();

</script>

</html>
